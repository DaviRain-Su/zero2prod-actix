#  Preface

## 这本书讨论的是什么？

后端开发的世界是广阔的。

你所处的背景对于解决你正在处理的问题的最佳工具和实践有着巨大的影响。

例如，[基于主干开发在连续部署到云环境](https://cloud.google.com/architecture/devops/devops-tech-trunk-based-development?hl=zh-cn)的软件[编写](https://services.google.com/fh/files/misc/state-of-devops-2019.pdf)中非常有效。

然而，同样的方法可能不适合那些销售由他们的客户在本地托管和运行的软件的团队的商业模式和面临的挑战 ,他们更有可能受益于[Gitflow](https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow)方法。

如果你是独自工作，你可以直接推送到主分支。

在软件开发领域很少有绝对的规则，我认为在评估任何技术或方法的优缺点时，澄清你的观点是有益的。

> 《从零到生产》将侧重讨论在一个由四到五名经验和熟练程度不同的工程师组成的团队中编写云原生应用程序所面临的挑战。

## Cloud-native applications

定义什么是云原生应用程序本身就是一个需要一本全新书籍[1]来讨论的话题。与其规定云原生应用程序应该是什么样的，我们可以明确我们期望它们能够做到什么。

借用 Cornelia Davis 的话，我们期望云原生应用程序具备以下特点：
- 在容易出现故障的环境中实现高可用性；
- 允许我们在零停机时间的情况下持续发布新版本；
- 能够处理动态工作负载（例如请求量）。

这些要求对我们软件架构的可行解决方案空间产生了深远影响。

高可用性意味着我们的应用程序应该能够在一台或多台机器突然发生故障的情况下无停机地提供服务（在云环境[2]中很常见）。这迫使我们的应用程序必须是分布式的 - 应该在多台机器上运行多个实例。

如果我们想要处理动态工作负载，也是如此 - 我们应该能够测量我们的系统是否负载过重，并通过启动应用程序的新实例来为问题提供更多的计算资源。这还要求我们的基础设施必须具备弹性，以避免过度配置和相关的成本。

运行一个复制的应用程序会影响我们对数据持久性的处理方式 - 我们将避免将本地文件系统用作我们的主要存储解决方案，而是依赖数据库来满足我们的持久性需求。

因此，《从零到生产》将广泛涵盖可能看似与纯后端应用程序开发不相关的主题。但云原生软件涉及到多方面，包括DevOps，因此我们将花费大量时间讨论与操作系统工艺传统相关的主题。

我们将介绍如何为你的Rust应用程序设置仪器，以收集日志、跟踪和度量标准，以便观察我们的系统。

我们将介绍如何通过迁移设置和演进数据库模式。

我们将涵盖使用Rust来处理云原生API的第一天和第二天的问题所需的所有材料。
___

[1] [Like the excellent Cloud-native patterns by Cornelia Davis!]( https://www.manning.com/books/cloud-native-patterns)

[2]. 例如，许多公司在[AWS Spot Instances](https://aws.amazon.com/cn/ec2/spot/)上运行他们的软件，以减少基础架构开销。Spot实例的价格是连续竞拍的结果，可能会比按需实例的相应全价便宜很多（高达90%便宜！）。

但要注意一点：AWS可以随时停用您的Spot实例。因此，您的软件必须具备容错性，才能充分利用这个机会。

[3] .假设您最近编写了代码。在软件开发的世界中，过去一年的自己可以视为陌生人，从所有方面来看。如果您即将重新开始您的旧项目，请祈祷您的过去自己为现在的自己编写了注释。

---

## Working in a team

这三个要求的影响超出了我们系统的技术特性，它们影响了我们如何构建软件。

为了能够快速向用户发布新版本的应用程序，我们需要确保我们的应用程序正常运行。如果你正在独立开发项目，你可以依赖于对整个系统的深入了解：你写了它，它可能足够小，可以随时完全放在你的头脑中。但如果你在一个商业项目的团队中工作，你经常会处理既不是由你编写也没有经过你审核的代码。原始作者可能已经离开了。如果你依赖于对代码的全面理解来防止它出现故障，那么每次要引入更改时，你都会因恐惧而瘫痪。你需要自动化测试。在每次提交上运行。在每个分支上运行。保持主分支健康。

你希望利用类型系统来使不良状态难以表示或不可能表示。你希望利用手头的每个工具，赋予团队的每个成员权力来开发这个软件。即使他们可能没有你那么有经验，也没有同样熟悉代码库或你所使用的技术。

因此，《从零到生产》将从一开始就强调测试驱动开发和持续集成 - 在我们甚至还没有一个Web服务器运行之前，我们就会建立一个CI管道！

我们将涵盖诸如API的黑盒测试和HTTP模拟等技术 - 尽管在Rust社区中并不广泛流行或有很好的文档，但它们非常强大。

我们还将借用[领域驱动设计](https://www.youtube.com/watch?v=PLFl95c-IiU)世界的术语和技术，将它们与[类型驱动设计](https://lexi-lambda.github.io/blog/2019/11/05/parse-don-t-validate/)相结合，以确保我们系统的正确性。

> 我们的主要关注点是企业软件：正确的代码，足够表达领域并具有足够的灵活性以支持随着时间推移的演进。

因此，我们会对平淡而正确的解决方案有一种偏好，即使它们会带来性能开销，而这些开销可以通过更谨慎和精雕细琢的方法进行优化。

首先让它能够运行，以后再优化（如果需要的话）。



## **Who Is This Book For**



Rust生态系统在消除采用障碍方面表现出了非凡的专注，提供了面向初学者和新手的精彩材料，从文档到不断改进编译器诊断的不懈努力。

为尽可能多的受众提供服务是有价值的。同时，试图始终面向所有人可能会产生有害的副作用：那些对中级和高级用户相关但对初学者来说绝对太过复杂的材料可能被忽视。

当我开始尝试使用异步/等待时，我亲身经历了这个问题。在我需要提高生产力的知识和我通过阅读《Rust书》或在Rust数值生态系统中工作所建立的知识之间存在显著差距。

我想要得到一个直截了当的答案：

> Can Rust be a productive language for API development?

这需要一些时间来弄清楚如何做到这一点。这就是为什么我正在写这本书。我正在为那些经验丰富的后端开发人员写这本书，他们已经阅读了Rust书籍，并现在试图迁移一些简单的系统。我正在为我团队中的新工程师写这本书，作为一个指南，帮助他们理解他们将在未来几周和几个月内贡献的代码库。我正在为一个目前我认为在Rust生态系统中现有的文章和资源未能满足其需求的小众群体写这本书。我正在为一年前的自己写这本书，以分享在这个过程中获得的知识：如果你在2022年将Rust用于后端开发，你的工具箱会是什么样子？有哪些设计模式？有哪些陷阱？如果你不符合这个描述，但你正在努力实现这一目标，我将尽力在这个过程中帮助你：虽然我们不会直接涵盖很多材料（例如，大多数Rust语言特性），但我会尽量提供必要的参考和链接，帮助你在路上学习/复习这些概念。让我们开始吧。
